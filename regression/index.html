
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Kristijan">
      
      
        <link rel="canonical" href="https://gabrielkp.com/enc/regression/">
      
      
        <link rel="prev" href="../run_all/">
      
      
        <link rel="next" href="../features/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>regression - The Encoders</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#encoders.regression.bootstrap_ridge" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="The Encoders" class="md-header__button md-logo" aria-label="The Encoders" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Encoders
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              regression
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/GabrielKP/enc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="https://kristijanarmeni.github.io/encoders_report" target="_blank" class="md-tabs__link">
          
  
  
  Report

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../run_all/" class="md-tabs__link">
          
  
  
  Documentation

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="The Encoders" class="md-nav__button md-logo" aria-label="The Encoders" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The Encoders
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/GabrielKP/enc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Report
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Report
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://kristijanarmeni.github.io/encoders_report" target="_blank" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run_all/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    run_all
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    regression
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    regression
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;bootstrap_ridge
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" bootstrap_ridge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(Rstim)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Rstim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(Rresp)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Rresp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(Pstim)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Pstim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(Presp)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Presp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(nboots)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;nboots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(chunklen)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;chunklen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(nchunks)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;nchunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(dtype)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dtype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(corrmin)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;corrmin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(joined)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;joined
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(singcutoff)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;singcutoff
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(normalpha)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;normalpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(single_alpha)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;single_alpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(use_corr)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;use_corr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;crossval_simple
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" crossval_simple">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(feature)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;feature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(n_train_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_train_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(test_story)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;test_story
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(n_repeats)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_repeats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(subject)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(tr_len)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;tr_len
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(ndelays)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ndelays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(interpolation)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;interpolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(ridge_implementation)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ridge_implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(use_cache)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;use_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(shuffle)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;shuffle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(seed)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;seed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(keep_train_stories_in_mem)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;keep_train_stories_in_mem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.mult_diag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mult_diag
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;pearsonr
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pearsonr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr(x1)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr(x2)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr_scorer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;pearsonr_scorer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pearsonr_scorer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr_scorer(estimator)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;estimator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr_scorer(X)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;X
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr_scorer(y)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;y
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ridge_corr
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ridge_corr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(Rstim)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Rstim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(Pstim)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Pstim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(Rresp)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Rresp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(Presp)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Presp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(normalpha)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;normalpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(dtype)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dtype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(corrmin)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;corrmin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(singcutoff)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;singcutoff
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(use_corr)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;use_corr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ridge_regression
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ridge_regression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(train_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(test_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;test_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(X_data_dict)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;X_data_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(y_data_dict)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;y_data_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(score_fct)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;score_fct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ridge_regression_huth
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ridge_regression_huth">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(train_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(test_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;test_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(X_data_dict)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;X_data_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(y_data_dict)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;y_data_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(score_fct)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;score_fct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.z_score" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;z_score
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" z_score">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.z_score(data)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.z_score(means)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;means
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.z_score(stds)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;stds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.zs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;zs
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" zs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.zs(x)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../download_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    download_data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;bootstrap_ridge
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" bootstrap_ridge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(Rstim)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Rstim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(Rresp)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Rresp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(Pstim)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Pstim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(Presp)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Presp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(nboots)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;nboots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(chunklen)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;chunklen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(nchunks)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;nchunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(dtype)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dtype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(corrmin)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;corrmin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(joined)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;joined
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(singcutoff)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;singcutoff
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(normalpha)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;normalpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(single_alpha)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;single_alpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.bootstrap_ridge(use_corr)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;use_corr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;crossval_simple
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" crossval_simple">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(feature)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;feature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(n_train_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_train_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(test_story)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;test_story
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(n_repeats)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_repeats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(subject)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(tr_len)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;tr_len
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(ndelays)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ndelays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(interpolation)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;interpolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(ridge_implementation)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ridge_implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(use_cache)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;use_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(shuffle)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;shuffle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(seed)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;seed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.crossval_simple(keep_train_stories_in_mem)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;keep_train_stories_in_mem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.mult_diag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mult_diag
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;pearsonr
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pearsonr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr(x1)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr(x2)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr_scorer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;pearsonr_scorer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pearsonr_scorer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr_scorer(estimator)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;estimator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr_scorer(X)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;X
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.pearsonr_scorer(y)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;y
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ridge_corr
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ridge_corr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(Rstim)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Rstim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(Pstim)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Pstim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(Rresp)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Rresp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(Presp)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;Presp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(normalpha)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;normalpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(dtype)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dtype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(corrmin)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;corrmin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(singcutoff)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;singcutoff
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_corr(use_corr)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;use_corr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ridge_regression
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ridge_regression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(train_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(test_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;test_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(X_data_dict)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;X_data_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(y_data_dict)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;y_data_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(score_fct)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;score_fct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ridge_regression_huth
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ridge_regression_huth">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(train_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(test_stories)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;test_stories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(X_data_dict)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;X_data_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(y_data_dict)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;y_data_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(score_fct)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;score_fct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.ridge_regression_huth(alphas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;alphas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.z_score" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;z_score
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" z_score">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.z_score(data)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.z_score(means)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;means
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoders.regression.z_score(stds)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;stds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoders.regression.zs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;zs
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" zs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encoders.regression.zs(x)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>regression</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="encoders.regression.bootstrap_ridge" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">bootstrap_ridge</span><span class="p">(</span><span class="n">Rstim</span><span class="p">,</span> <span class="n">Rresp</span><span class="p">,</span> <span class="n">Pstim</span><span class="p">,</span> <span class="n">Presp</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">nboots</span><span class="p">,</span> <span class="n">chunklen</span><span class="p">,</span> <span class="n">nchunks</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">single</span><span class="p">,</span> <span class="n">corrmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">joined</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">singcutoff</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">normalpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">single_alpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_corr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;ridge_corr&#39;</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Uses ridge regression with a bootstrapped held-out set to get optimal alpha
values for each response. [nchunks] random chunks of length [chunklen] will be taken
from [Rstim] and [Rresp] for each regression run.  [nboots] total regression runs
will be performed.  The best alpha value for each response will be averaged across
the bootstraps to estimate the best alpha for that response.</p>
<p>If [joined] is given, it should be a list of lists where the STRFs for all the
voxels in each sublist will be given the same regularization parameter (the one
that is the best on average).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(Rstim)" class="doc doc-heading doc-heading-parameter">                  <code>Rstim</code>
</h3>            </td>
            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TR">TR</span>, <span title="N">N</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training stimuli with TR time points and N features. Each feature should be
Z-scored across time.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(Rresp)" class="doc doc-heading doc-heading-parameter">                  <code>Rresp</code>
</h3>            </td>
            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TR">TR</span>, <span title="M">M</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training responses with TR time points and M different responses (voxels,
neurons, what-have-you). Each response should be Z-scored across time.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(Pstim)" class="doc doc-heading doc-heading-parameter">                  <code>Pstim</code>
</h3>            </td>
            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TP">TP</span>, <span title="N">N</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Test stimuli with TP time points and N features. Each feature should be
Z-scored across time.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(Presp)" class="doc doc-heading doc-heading-parameter">                  <code>Presp</code>
</h3>            </td>
            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TP">TP</span>, <span title="M">M</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Test responses with TP time points and M different responses. Each response
should be Z-scored across
time.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(alphas)" class="doc doc-heading doc-heading-parameter">                  <code>alphas</code>
</h3>            </td>
            <td>
                  <code>(<span title="list">list</span> or <span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="A">A</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ridge parameters that will be tested. Should probably be log-spaced.
np.logspace(0, 3, 20) works well.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(nboots)" class="doc doc-heading doc-heading-parameter">                  <code>nboots</code>
</h3>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of bootstrap samples to run. 15 to 30 works well.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(chunklen)" class="doc doc-heading doc-heading-parameter">                  <code>chunklen</code>
</h3>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>On each sample, the training data is broken into chunks of this length. This
should be a few times
longer than your delay/STRF. e.g. for a STRF with 3 delays, I use chunks of
length 10.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(nchunks)" class="doc doc-heading doc-heading-parameter">                  <code>nchunks</code>
</h3>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of training chunks held out to test ridge parameters for each
bootstrap sample. The product of nchunks and chunklen is the total number of
training samples held out for each sample, and this product should be about 20
percent of the total length of the training data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(dtype)" class="doc doc-heading doc-heading-parameter">                  <code>dtype</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.dtype">dtype</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All data will be cast as this dtype for computation. np.single is used by
default for memory efficiency, as using np.double will thrash most machines on a
big problem. If you want to do regression on complex variables, this should be
changed to np.complex128.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.single">single</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(corrmin)" class="doc doc-heading doc-heading-parameter">                  <code>corrmin</code>
</h3>            </td>
            <td>
                  <code>float in [0..1]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Purely for display purposes. After each alpha is tested for each bootstrap
sample, the number of responses with correlation greater than this value will be
printed. For long-running regressions this can give a rough sense of how well
the model works before it's done.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(joined)" class="doc doc-heading doc-heading-parameter">                  <code>joined</code>
</h3>            </td>
            <td>
                  <code>None or list of array_like indices</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If you want the STRFs for two (or more) responses to be directly comparable, you
need to ensure that the regularization parameter that they use is the same. To
do that, supply a list of the response sets that should use the same ridge
parameter here. For example, if you have four responses, joined could be
[np.array([0,1]), np.array([2,3])], in which case responses 0 and 1 will use the
same ridge parameter (which will be parameter that is best on average for those
two), and likewise for responses 2 and 3.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(singcutoff)" class="doc doc-heading doc-heading-parameter">                  <code>singcutoff</code>
</h3>            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first step in ridge regression is computing the singular value decomposition
(SVD) of the stimulus Rstim. If Rstim is not full rank, some singular values
will be approximately equal to zero and the corresponding singular vectors will
be noise. These singular values/vectors should be removed both for speed (the
fewer multiplications the better!) and accuracy. Any singular values less than
singcutoff will be removed.</p>
              </div>
            </td>
            <td>
                  <code>1e-10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(normalpha)" class="doc doc-heading doc-heading-parameter">                  <code>normalpha</code>
</h3>            </td>
            <td>
                  <code><span title="boolean">boolean</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether ridge parameters (alphas) should be normalized by the Frobenius norm of
Rstim. Good for rigorously comparing models with different numbers of
parameters.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(single_alpha)" class="doc doc-heading doc-heading-parameter">                  <code>single_alpha</code>
</h3>            </td>
            <td>
                  <code><span title="boolean">boolean</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use a single alpha for all responses. Good
foridentification/decoding.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.bootstrap_ridge(use_corr)" class="doc doc-heading doc-heading-parameter">                  <code>use_corr</code>
</h3>            </td>
            <td>
                  <code><span title="boolean">boolean</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, this function will use correlation as its metric of model fit. If
False, this function will instead use variance explained (R-squared) as its
metric of model fit. For ridge regression this can make a big difference --
highly regularized solutions will have very small norms and will thus explain
very little variance while still leading to high correlations, as correlation
is scale-free while R**2 is not.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>wt</code></td>            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="N">N</span>, <span title="M">M</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regression weights for N features and M responses.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>corrs</code></td>            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="M">M</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation set correlations. Predicted responses for the validation set are
obtained using the regression weights: pred = np.dot(Pstim, wt), and then the
correlation between each predicted response and each column in Presp is found.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>alphas</code></td>            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="M">M</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The regularization coefficient (alpha) selected for each voxel using bootstrap
cross-validation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>bootstrap_corrs</code></td>            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="A">A</span>, <span title="M">M</span>, <span title="B">B</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Correlation between predicted and actual responses on randomly held out portions
of the training set, for each of A alphas, M voxels, and B bootstrap samples.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valinds</code></td>            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TH">TH</span>, <span title="B">B</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The indices of the training data that were used as "validation" for each
bootstrap sample.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bootstrap_ridge</span><span class="p">(</span>
    <span class="n">Rstim</span><span class="p">,</span>
    <span class="n">Rresp</span><span class="p">,</span>
    <span class="n">Pstim</span><span class="p">,</span>
    <span class="n">Presp</span><span class="p">,</span>
    <span class="n">alphas</span><span class="p">,</span>
    <span class="n">nboots</span><span class="p">,</span>
    <span class="n">chunklen</span><span class="p">,</span>
    <span class="n">nchunks</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">single</span><span class="p">,</span>
    <span class="n">corrmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">joined</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">singcutoff</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span>
    <span class="n">normalpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">single_alpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">use_corr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;ridge_corr&quot;</span><span class="p">),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses ridge regression with a bootstrapped held-out set to get optimal alpha</span>
<span class="sd">    values for each response. [nchunks] random chunks of length [chunklen] will be taken</span>
<span class="sd">    from [Rstim] and [Rresp] for each regression run.  [nboots] total regression runs</span>
<span class="sd">    will be performed.  The best alpha value for each response will be averaged across</span>
<span class="sd">    the bootstraps to estimate the best alpha for that response.</span>

<span class="sd">    If [joined] is given, it should be a list of lists where the STRFs for all the</span>
<span class="sd">    voxels in each sublist will be given the same regularization parameter (the one</span>
<span class="sd">    that is the best on average).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Rstim : array_like, shape (TR, N)</span>
<span class="sd">        Training stimuli with TR time points and N features. Each feature should be</span>
<span class="sd">        Z-scored across time.</span>
<span class="sd">    Rresp : array_like, shape (TR, M)</span>
<span class="sd">        Training responses with TR time points and M different responses (voxels,</span>
<span class="sd">        neurons, what-have-you). Each response should be Z-scored across time.</span>
<span class="sd">    Pstim : array_like, shape (TP, N)</span>
<span class="sd">        Test stimuli with TP time points and N features. Each feature should be</span>
<span class="sd">        Z-scored across time.</span>
<span class="sd">    Presp : array_like, shape (TP, M)</span>
<span class="sd">        Test responses with TP time points and M different responses. Each response</span>
<span class="sd">        should be Z-scored across</span>
<span class="sd">        time.</span>
<span class="sd">    alphas : list or array_like, shape (A,)</span>
<span class="sd">        Ridge parameters that will be tested. Should probably be log-spaced.</span>
<span class="sd">        np.logspace(0, 3, 20) works well.</span>
<span class="sd">    nboots : int</span>
<span class="sd">        The number of bootstrap samples to run. 15 to 30 works well.</span>
<span class="sd">    chunklen : int</span>
<span class="sd">        On each sample, the training data is broken into chunks of this length. This</span>
<span class="sd">        should be a few times</span>
<span class="sd">        longer than your delay/STRF. e.g. for a STRF with 3 delays, I use chunks of</span>
<span class="sd">        length 10.</span>
<span class="sd">    nchunks : int</span>
<span class="sd">        The number of training chunks held out to test ridge parameters for each</span>
<span class="sd">        bootstrap sample. The product of nchunks and chunklen is the total number of</span>
<span class="sd">        training samples held out for each sample, and this product should be about 20</span>
<span class="sd">        percent of the total length of the training data.</span>
<span class="sd">    dtype : np.dtype</span>
<span class="sd">        All data will be cast as this dtype for computation. np.single is used by</span>
<span class="sd">        default for memory efficiency, as using np.double will thrash most machines on a</span>
<span class="sd">        big problem. If you want to do regression on complex variables, this should be</span>
<span class="sd">        changed to np.complex128.</span>
<span class="sd">    corrmin : float in [0..1]</span>
<span class="sd">        Purely for display purposes. After each alpha is tested for each bootstrap</span>
<span class="sd">        sample, the number of responses with correlation greater than this value will be</span>
<span class="sd">        printed. For long-running regressions this can give a rough sense of how well</span>
<span class="sd">        the model works before it&#39;s done.</span>
<span class="sd">    joined : None or list of array_like indices</span>
<span class="sd">        If you want the STRFs for two (or more) responses to be directly comparable, you</span>
<span class="sd">        need to ensure that the regularization parameter that they use is the same. To</span>
<span class="sd">        do that, supply a list of the response sets that should use the same ridge</span>
<span class="sd">        parameter here. For example, if you have four responses, joined could be</span>
<span class="sd">        [np.array([0,1]), np.array([2,3])], in which case responses 0 and 1 will use the</span>
<span class="sd">        same ridge parameter (which will be parameter that is best on average for those</span>
<span class="sd">        two), and likewise for responses 2 and 3.</span>
<span class="sd">    singcutoff : float</span>
<span class="sd">        The first step in ridge regression is computing the singular value decomposition</span>
<span class="sd">        (SVD) of the stimulus Rstim. If Rstim is not full rank, some singular values</span>
<span class="sd">        will be approximately equal to zero and the corresponding singular vectors will</span>
<span class="sd">        be noise. These singular values/vectors should be removed both for speed (the</span>
<span class="sd">        fewer multiplications the better!) and accuracy. Any singular values less than</span>
<span class="sd">        singcutoff will be removed.</span>
<span class="sd">    normalpha : boolean</span>
<span class="sd">        Whether ridge parameters (alphas) should be normalized by the Frobenius norm of</span>
<span class="sd">        Rstim. Good for rigorously comparing models with different numbers of</span>
<span class="sd">        parameters.</span>
<span class="sd">    single_alpha : boolean</span>
<span class="sd">        Whether to use a single alpha for all responses. Good</span>
<span class="sd">        foridentification/decoding.</span>
<span class="sd">    use_corr : boolean</span>
<span class="sd">        If True, this function will use correlation as its metric of model fit. If</span>
<span class="sd">        False, this function will instead use variance explained (R-squared) as its</span>
<span class="sd">        metric of model fit. For ridge regression this can make a big difference --</span>
<span class="sd">        highly regularized solutions will have very small norms and will thus explain</span>
<span class="sd">        very little variance while still leading to high correlations, as correlation</span>
<span class="sd">        is scale-free while R**2 is not.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wt : array_like, shape (N, M)</span>
<span class="sd">        Regression weights for N features and M responses.</span>
<span class="sd">    corrs : array_like, shape (M,)</span>
<span class="sd">        Validation set correlations. Predicted responses for the validation set are</span>
<span class="sd">        obtained using the regression weights: pred = np.dot(Pstim, wt), and then the</span>
<span class="sd">        correlation between each predicted response and each column in Presp is found.</span>
<span class="sd">    alphas : array_like, shape (M,)</span>
<span class="sd">        The regularization coefficient (alpha) selected for each voxel using bootstrap</span>
<span class="sd">        cross-validation.</span>
<span class="sd">    bootstrap_corrs : array_like, shape (A, M, B)</span>
<span class="sd">        Correlation between predicted and actual responses on randomly held out portions</span>
<span class="sd">        of the training set, for each of A alphas, M voxels, and B bootstrap samples.</span>
<span class="sd">    valinds : array_like, shape (TH, B)</span>
<span class="sd">        The indices of the training data that were used as &quot;validation&quot; for each</span>
<span class="sd">        bootstrap sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nresp</span><span class="p">,</span> <span class="n">nvox</span> <span class="o">=</span> <span class="n">Rresp</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">valinds</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">## Will hold the indices into the validation data for each bootstrap</span>

    <span class="n">Rcmats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bi</span> <span class="ow">in</span> <span class="n">counter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nboots</span><span class="p">),</span> <span class="n">countevery</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">nboots</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Selecting held-out test set..&quot;</span><span class="p">)</span>
        <span class="n">allinds</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">nresp</span><span class="p">)</span>
        <span class="n">indchunks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">allinds</span><span class="p">)]</span> <span class="o">*</span> <span class="n">chunklen</span><span class="p">))</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">indchunks</span><span class="p">)</span>
        <span class="n">heldinds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">indchunks</span><span class="p">[:</span><span class="n">nchunks</span><span class="p">]))</span>
        <span class="n">notheldinds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">allinds</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">heldinds</span><span class="p">))</span>
        <span class="n">valinds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">heldinds</span><span class="p">)</span>

        <span class="n">RRstim</span> <span class="o">=</span> <span class="n">Rstim</span><span class="p">[</span><span class="n">notheldinds</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">PRstim</span> <span class="o">=</span> <span class="n">Rstim</span><span class="p">[</span><span class="n">heldinds</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">RRresp</span> <span class="o">=</span> <span class="n">Rresp</span><span class="p">[</span><span class="n">notheldinds</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">PRresp</span> <span class="o">=</span> <span class="n">Rresp</span><span class="p">[</span><span class="n">heldinds</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1">## Run ridge regression using this test set</span>
        <span class="n">Rcmat</span> <span class="o">=</span> <span class="n">ridge_corr</span><span class="p">(</span>
            <span class="n">RRstim</span><span class="p">,</span>
            <span class="n">PRstim</span><span class="p">,</span>
            <span class="n">RRresp</span><span class="p">,</span>
            <span class="n">PRresp</span><span class="p">,</span>
            <span class="n">alphas</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">corrmin</span><span class="o">=</span><span class="n">corrmin</span><span class="p">,</span>
            <span class="n">singcutoff</span><span class="o">=</span><span class="n">singcutoff</span><span class="p">,</span>
            <span class="n">normalpha</span><span class="o">=</span><span class="n">normalpha</span><span class="p">,</span>
            <span class="n">use_corr</span><span class="o">=</span><span class="n">use_corr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">Rcmats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rcmat</span><span class="p">)</span>

    <span class="c1">## Find weights for each voxel</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Vh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">Rstim</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;NORMAL SVD FAILED, trying more robust dgesvd..&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">text.regression.svd_dgesvd</span> <span class="kn">import</span> <span class="n">svd_dgesvd</span>  <span class="c1"># type: ignore</span>

        <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Vh</span> <span class="o">=</span> <span class="n">svd_dgesvd</span><span class="p">(</span><span class="n">Rstim</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">## Normalize alpha by the Frobenius norm</span>
    <span class="c1"># frob = np.sqrt((S**2).sum()) ## Frobenius!</span>
    <span class="n">frob</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># frob = S.sum()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total training stimulus has Frobenius norm: </span><span class="si">%0.03f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">frob</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalpha</span><span class="p">:</span>
        <span class="n">nalphas</span> <span class="o">=</span> <span class="n">alphas</span> <span class="o">*</span> <span class="n">frob</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nalphas</span> <span class="o">=</span> <span class="n">alphas</span>

    <span class="n">allRcorrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">Rcmats</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">single_alpha</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding best alpha for each response..&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">joined</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">## Find best alpha for each voxel</span>
            <span class="n">meanbootcorrs</span> <span class="o">=</span> <span class="n">allRcorrs</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">bestalphainds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">meanbootcorrs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">valphas</span> <span class="o">=</span> <span class="n">nalphas</span><span class="p">[</span><span class="n">bestalphainds</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## Find best alpha for each group of voxels</span>
            <span class="n">valphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nvox</span><span class="p">,))</span>
            <span class="k">for</span> <span class="n">jl</span> <span class="ow">in</span> <span class="n">joined</span><span class="p">:</span>
                <span class="n">jcorrs</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">allRcorrs</span><span class="p">[:,</span> <span class="n">jl</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>  <span class="c1">## Mean across voxels in the set, then mean across bootstraps</span>
                <span class="n">bestalpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">jcorrs</span><span class="p">)</span>
                <span class="n">valphas</span><span class="p">[</span><span class="n">jl</span><span class="p">]</span> <span class="o">=</span> <span class="n">nalphas</span><span class="p">[</span><span class="n">bestalpha</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding single best alpha..&quot;</span><span class="p">)</span>
        <span class="n">meanbootcorr</span> <span class="o">=</span> <span class="n">allRcorrs</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bestalphaind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">meanbootcorr</span><span class="p">)</span>
        <span class="n">bestalpha</span> <span class="o">=</span> <span class="n">alphas</span><span class="p">[</span><span class="n">bestalphaind</span><span class="p">]</span>
        <span class="n">valphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bestalpha</span><span class="p">]</span> <span class="o">*</span> <span class="n">nvox</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Best alpha = </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">bestalpha</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing weights for each response using entire training set..&quot;</span><span class="p">)</span>
    <span class="n">UR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">Rresp</span><span class="p">))</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Presp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">wt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Rstim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Rresp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">ai</span><span class="p">,</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nalphas</span><span class="p">):</span>
        <span class="n">selvox</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">valphas</span> <span class="o">==</span> <span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">awt</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="p">[</span><span class="n">Vh</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">S</span> <span class="o">/</span> <span class="p">(</span><span class="n">S</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="n">UR</span><span class="p">[:,</span> <span class="n">selvox</span><span class="p">]])</span>
        <span class="n">pred</span><span class="p">[:,</span> <span class="n">selvox</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Pstim</span><span class="p">,</span> <span class="n">awt</span><span class="p">)</span>
        <span class="n">wt</span><span class="p">[:,</span> <span class="n">selvox</span><span class="p">]</span> <span class="o">=</span> <span class="n">awt</span>

    <span class="c1">## Find test correlations</span>
    <span class="n">nnpred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">corrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">Presp</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">],</span> <span class="n">nnpred</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Presp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">wt</span><span class="p">,</span> <span class="n">corrs</span><span class="p">,</span> <span class="n">valphas</span><span class="p">,</span> <span class="n">allRcorrs</span><span class="p">,</span> <span class="n">valinds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.crossval_simple" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">crossval_simple</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">stories</span><span class="p">,</span> <span class="n">n_train_stories</span><span class="p">,</span> <span class="n">test_story</span><span class="p">,</span> <span class="n">n_repeats</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">tr_len</span><span class="p">,</span> <span class="n">ndelays</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">,</span> <span class="n">ridge_implementation</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">keep_train_stories_in_mem</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">nboots</span><span class="p">,</span> <span class="n">chunklen</span><span class="p">,</span> <span class="n">nchunks</span><span class="p">,</span> <span class="n">singcutoff</span><span class="p">,</span> <span class="n">single_alpha</span><span class="p">,</span> <span class="n">use_corr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Run regression for n_repeats and return results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(feature)" class="doc doc-heading doc-heading-parameter">                  <code>feature</code>
</h3>            </td>
            <td>
                  <code>(<span title="envelope">envelope</span>, <span title="eng1000">eng1000</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which feature to use for the regression. "envelope": audio envelope that
participants heard. "eng1000": embeddings computed from the words that
participants heard.)</p>
              </div>
            </td>
            <td>
                  <code>&#34;envelope&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(stories)" class="doc doc-heading doc-heading-parameter">                  <code>stories</code>
</h3>            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="list">list</span>[<span title="str">str</span>], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pool of stories, the default is determined by the config.yaml</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(n_train_stories)" class="doc doc-heading doc-heading-parameter">                  <code>n_train_stories</code>
</h3>            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of training stories sampled from <code>stories</code>, if this is <code>None</code> will
use all except one story.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(test_story)" class="doc doc-heading doc-heading-parameter">                  <code>test_story</code>
</h3>            </td>
            <td>
                  <code>str or `None`</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The story on which the regression models will be tested.
If <code>None</code>, the test story will be randomly selected from the pool of stories.</p>
              </div>
            </td>
            <td>
                  <code>`None`</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(n_repeats)" class="doc doc-heading doc-heading-parameter">                  <code>n_repeats</code>
</h3>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>cross_validation="simple"</code>, determines how often regression is
repeated on a different train/test set.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(subject)" class="doc doc-heading doc-heading-parameter">                  <code>subject</code>
</h3>            </td>
            <td>
                  <code>(<span title="UTS01">UTS01</span>, <span title="UTS02">UTS02</span>, <span title="UTS03">UTS03</span>, <span title="UTS04">UTS04</span>, <span title="UTS05">UTS05</span>, <span title="UTS06">UTS06</span>, <span title="UTS07">UTS07</span>, <span title="UTS08">UTS08</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default="UTS02"
Subject identifier</p>
              </div>
            </td>
            <td>
                  <code>&#34;UTS01&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(tr_len)" class="doc doc-heading doc-heading-parameter">                  <code>tr_len</code>
</h3>            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Length of tr-windows used to sample fMRI data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(ndelays)" class="doc doc-heading doc-heading-parameter">                  <code>ndelays</code>
</h3>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many delays are used to model the HRF, which is modeled by adding
a shifted set of duplicated features for each delay. <code>ndelays=5</code> implies
that the the features of the stimulus are shifted concatinated 5 times
to training/testing data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(interpolation)" class="doc doc-heading doc-heading-parameter">                  <code>interpolation</code>
</h3>            </td>
            <td>
                  <code>(<span title="lanczos">lanczos</span>, <span title="average">average</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use lanczos interpolation or just average the words within a TR.
Only applies to the 'eng1000' feature.</p>
              </div>
            </td>
            <td>
                  <code>&#34;lanczos&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(ridge_implementation)" class="doc doc-heading doc-heading-parameter">                  <code>ridge_implementation</code>
</h3>            </td>
            <td>
                  <code>(<span title="ridgeCV">ridgeCV</span>, <span title="ridge_huth">ridge_huth</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which implementation of ridge regression to use. "ridgeCV" uses the RidgeCV
function from sklearn.
"ridge_huth" uses the implementation from the Huth lab codebase which applies
SVD to the data matrix and computes correlation scores with bootstrapping.</p>
              </div>
            </td>
            <td>
                  <code>&#34;ridgeCV&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(alphas)" class="doc doc-heading doc-heading-parameter">                  <code>alphas</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of alpha values to optimize over.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(use_cache)" class="doc doc-heading doc-heading-parameter">                  <code>use_cache</code>
</h3>            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the cache is used for <code>envelope</code> features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(shuffle)" class="doc doc-heading doc-heading-parameter">                  <code>shuffle</code>
</h3>            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to shuffle the predictors (features).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(seed)" class="doc doc-heading doc-heading-parameter">                  <code>seed</code>
</h3>            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed determining sampling of stories.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.crossval_simple(keep_train_stories_in_mem)" class="doc doc-heading doc-heading-parameter">                  <code>keep_train_stories_in_mem</code>
</h3>            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether stories are kept in memory after first loading. Unless when using all
stories turning this off will reduce the memory footprint, but increase the
time is spent loading data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>mean_scores</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mean prediction scores for each repeat.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>scores_list</code></td>            <td>
                  <code>list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scores for each repeat.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>weights</code></td>            <td>
                  <code>list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The regression weights for each repeat.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>alphas</code></td>            <td>
                  <code>list of float or list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The best alphas for each voxel, for each repeat.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">crossval_simple</span><span class="p">(</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">stories</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">n_train_stories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">test_story</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">n_repeats</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tr_len</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ndelays</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">ridge_implementation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">keep_train_stories_in_mem</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">alphas</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">nboots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">chunklen</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">nchunks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">singcutoff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">single_alpha</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">use_corr</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run regression for n_repeats and return results.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    feature : {&quot;envelope&quot;, &quot;eng1000&quot;}</span>
<span class="sd">        Which feature to use for the regression. &quot;envelope&quot;: audio envelope that</span>
<span class="sd">        participants heard. &quot;eng1000&quot;: embeddings computed from the words that</span>
<span class="sd">        participants heard.)</span>
<span class="sd">    stories: list[str], default=STORIES</span>
<span class="sd">        Pool of stories, the default is determined by the config.yaml</span>
<span class="sd">    n_train_stories: int, optional</span>
<span class="sd">        The amount of training stories sampled from `stories`, if this is `None` will</span>
<span class="sd">        use all except one story.</span>
<span class="sd">    test_story : str or `None`, default=`None`</span>
<span class="sd">        The story on which the regression models will be tested.</span>
<span class="sd">        If `None`, the test story will be randomly selected from the pool of stories.</span>
<span class="sd">    n_repeats : int, default=5</span>
<span class="sd">        If `cross_validation=&quot;simple&quot;`, determines how often regression is</span>
<span class="sd">        repeated on a different train/test set.</span>
<span class="sd">    subject : {&quot;UTS01&quot;, &quot;UTS02&quot;, &quot;UTS03&quot;, &quot;UTS04&quot;, &quot;UTS05&quot;, &quot;UTS06&quot;, &quot;UTS07&quot;, &quot;UTS08&quot;},</span>
<span class="sd">        default=&quot;UTS02&quot;</span>
<span class="sd">        Subject identifier</span>
<span class="sd">    tr_len: float, default=2.0</span>
<span class="sd">        Length of tr-windows used to sample fMRI data.</span>
<span class="sd">    ndelays: int, default=4</span>
<span class="sd">        How many delays are used to model the HRF, which is modeled by adding</span>
<span class="sd">        a shifted set of duplicated features for each delay. `ndelays=5` implies</span>
<span class="sd">        that the the features of the stimulus are shifted concatinated 5 times</span>
<span class="sd">        to training/testing data.</span>
<span class="sd">    interpolation : {&quot;lanczos&quot;, &quot;average&quot;}</span>
<span class="sd">        Whether to use lanczos interpolation or just average the words within a TR.</span>
<span class="sd">        Only applies to the &#39;eng1000&#39; feature.</span>
<span class="sd">    ridge_implementation : {&quot;ridgeCV&quot;, &quot;ridge_huth&quot;}, default=&quot;ridge_huth&quot;</span>
<span class="sd">        Which implementation of ridge regression to use. &quot;ridgeCV&quot; uses the RidgeCV</span>
<span class="sd">        function from sklearn.</span>
<span class="sd">        &quot;ridge_huth&quot; uses the implementation from the Huth lab codebase which applies</span>
<span class="sd">        SVD to the data matrix and computes correlation scores with bootstrapping.</span>
<span class="sd">    alphas : np.ndarray</span>
<span class="sd">        Array of alpha values to optimize over.</span>
<span class="sd">    use_cache: bool</span>
<span class="sd">        Whether the cache is used for `envelope` features.</span>
<span class="sd">    shuffle: bool</span>
<span class="sd">        Whether to shuffle the predictors (features).</span>
<span class="sd">    seed: int | None, default=123</span>
<span class="sd">        Seed determining sampling of stories.</span>
<span class="sd">    keep_train_stories_in_mem: bool</span>
<span class="sd">        Whether stories are kept in memory after first loading. Unless when using all</span>
<span class="sd">        stories turning this off will reduce the memory footprint, but increase the</span>
<span class="sd">        time is spent loading data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mean_scores : np.ndarray</span>
<span class="sd">        The mean prediction scores for each repeat.</span>
<span class="sd">    scores_list : list of np.ndarray</span>
<span class="sd">        The scores for each repeat.</span>
<span class="sd">    weights : list of np.ndarray</span>
<span class="sd">        The regression weights for each repeat.</span>
<span class="sd">    alphas : list of float or list of np.ndarray</span>
<span class="sd">        The best alphas for each voxel, for each repeat.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">stories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stories</span> <span class="o">=</span> <span class="n">STORIES</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stories</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config parameter invalid: STORIES: </span><span class="si">{</span><span class="n">stories</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">stories</span> <span class="o">=</span> <span class="n">stories</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">n_train_stories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_train_stories</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stories</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">test_story</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">test_story</span> <span class="ow">in</span> <span class="n">stories</span><span class="p">:</span>
        <span class="n">stories</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">test_story</span><span class="p">)</span>

    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># data dicts</span>
    <span class="n">X_data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">y_data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1"># result arrays</span>
    <span class="n">scores_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">weights_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">best_alphas_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">repeat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_repeats</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Repeat </span><span class="si">{</span><span class="n">repeat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 1. choose stories to sample for this repeat</span>
        <span class="k">if</span> <span class="n">test_story</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curr_all_stories</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">stories</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_train_stories</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">curr_train_stories</span> <span class="o">=</span> <span class="n">curr_all_stories</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">curr_test_stories</span> <span class="o">=</span> <span class="n">curr_all_stories</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curr_train_stories</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">stories</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_train_stories</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">curr_test_stories</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_story</span><span class="p">]</span>
            <span class="n">curr_all_stories</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">curr_train_stories</span><span class="p">,</span> <span class="o">*</span><span class="n">curr_test_stories</span><span class="p">]</span>

        <span class="c1"># 2. load data for stories</span>
        <span class="n">stories_to_load</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">curr_all_stories</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X_data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stories_to_load</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading data&quot;</span><span class="p">)</span>
            <span class="n">X_data_dict_new</span><span class="p">,</span> <span class="n">y_data_dict_new</span> <span class="o">=</span> <span class="n">load_data_dict</span><span class="p">(</span>
                <span class="n">stories_to_load</span><span class="p">,</span>
                <span class="n">subject</span><span class="p">,</span>
                <span class="n">feature</span><span class="p">,</span>
                <span class="n">interpolation</span><span class="p">,</span>
                <span class="n">shuffle</span><span class="p">,</span>
                <span class="n">tr_len</span><span class="p">,</span>
                <span class="n">ndelays</span><span class="p">,</span>
                <span class="n">use_cache</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">X_data_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">X_data_dict_new</span><span class="p">)</span>
            <span class="n">y_data_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y_data_dict_new</span><span class="p">)</span>

        <span class="c1"># 3. run regression</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running regression | n_train_stories: </span><span class="si">{</span><span class="n">n_train_stories</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; | implementation: </span><span class="si">{</span><span class="n">ridge_implementation</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ridge_implementation</span> <span class="o">==</span> <span class="s2">&quot;ridge_huth&quot;</span><span class="p">:</span>
            <span class="n">scores</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">best_alphas</span> <span class="o">=</span> <span class="n">ridge_regression_huth</span><span class="p">(</span>
                <span class="n">train_stories</span><span class="o">=</span><span class="n">curr_train_stories</span><span class="p">,</span>
                <span class="n">test_stories</span><span class="o">=</span><span class="n">curr_test_stories</span><span class="p">,</span>
                <span class="n">X_data_dict</span><span class="o">=</span><span class="n">X_data_dict</span><span class="p">,</span>
                <span class="n">y_data_dict</span><span class="o">=</span><span class="n">y_data_dict</span><span class="p">,</span>
                <span class="n">score_fct</span><span class="o">=</span><span class="n">pearsonr</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span>
                <span class="n">nboots</span><span class="o">=</span><span class="n">nboots</span><span class="p">,</span>
                <span class="n">chunklen</span><span class="o">=</span><span class="n">chunklen</span><span class="p">,</span>
                <span class="n">nchunks</span><span class="o">=</span><span class="n">nchunks</span><span class="p">,</span>
                <span class="n">singcutoff</span><span class="o">=</span><span class="n">singcutoff</span><span class="p">,</span>
                <span class="n">single_alpha</span><span class="o">=</span><span class="n">single_alpha</span><span class="p">,</span>
                <span class="n">use_corr</span><span class="o">=</span><span class="n">use_corr</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scores</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">best_alphas</span> <span class="o">=</span> <span class="n">ridge_regression</span><span class="p">(</span>
                <span class="n">train_stories</span><span class="o">=</span><span class="n">curr_train_stories</span><span class="p">,</span>
                <span class="n">test_stories</span><span class="o">=</span><span class="n">curr_test_stories</span><span class="p">,</span>
                <span class="n">X_data_dict</span><span class="o">=</span><span class="n">X_data_dict</span><span class="p">,</span>
                <span class="n">y_data_dict</span><span class="o">=</span><span class="n">y_data_dict</span><span class="p">,</span>
                <span class="n">score_fct</span><span class="o">=</span><span class="n">pearsonr</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean corr: </span><span class="si">{</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max corr : </span><span class="si">{</span><span class="n">scores</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_train_stories_in_mem</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">X_data_dict</span>
            <span class="k">del</span> <span class="n">y_data_dict</span>
            <span class="n">X_data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">y_data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># 4. append results</span>
        <span class="n">scores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="n">weights_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">best_alphas_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_alphas</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores_list</span><span class="p">),</span> <span class="n">weights_list</span><span class="p">,</span> <span class="n">best_alphas_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.mult_diag" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">mult_diag</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">mtx</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Multiply a full matrix by a diagonal matrix.
This function should always be faster than dot.</p>
<p>Input:
  d -- 1D (N,) array (contains the diagonal elements)
  mtx -- 2D (N,N) array</p>
<p>Output:
  mult_diag(d, mts, left=True) == dot(diag(d), mtx)
  mult_diag(d, mts, left=False) == dot(mtx, diag(d))</p>
<p>By Pietro Berkes
From http://mail.scipy.org/pipermail/numpy-discussion/2007-March/026807.html</p>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mult_diag</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">mtx</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply a full matrix by a diagonal matrix.</span>
<span class="sd">    This function should always be faster than dot.</span>

<span class="sd">    Input:</span>
<span class="sd">      d -- 1D (N,) array (contains the diagonal elements)</span>
<span class="sd">      mtx -- 2D (N,N) array</span>

<span class="sd">    Output:</span>
<span class="sd">      mult_diag(d, mts, left=True) == dot(diag(d), mtx)</span>
<span class="sd">      mult_diag(d, mts, left=False) == dot(mtx, diag(d))</span>

<span class="sd">    By Pietro Berkes</span>
<span class="sd">    From http://mail.scipy.org/pipermail/numpy-discussion/2007-March/026807.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">left</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">mtx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">mtx</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.pearsonr" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">pearsonr</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the pearson correlation between two vectors or two matrices of the same
shape (in which case the correlation is computed for each pair of column vectors).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.pearsonr(x1)" class="doc doc-heading doc-heading-parameter">                  <code>x1</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape = (n_samples,) or (n_samples, n_targets)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.pearsonr(x2)" class="doc doc-heading doc-heading-parameter">                  <code>x2</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape = (n_samples,) or (n_samples, n_targets), same shape as x1</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>corr</code></td>            <td>
                  <code><span title="float">float</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pearson correlation between x1 and x2. If x1 and x2 are matrices, returns an
array of correlations with shape (n_targets,)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pearsonr</span><span class="p">(</span><span class="n">x1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the pearson correlation between two vectors or two matrices of the same</span>
<span class="sd">    shape (in which case the correlation is computed for each pair of column vectors).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x1 : np.ndarray</span>
<span class="sd">        shape = (n_samples,) or (n_samples, n_targets)</span>
<span class="sd">    x2 : np.ndarray</span>
<span class="sd">        shape = (n_samples,) or (n_samples, n_targets), same shape as x1</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    corr: float or np.ndarray</span>
<span class="sd">        Pearson correlation between x1 and x2. If x1 and x2 are matrices, returns an</span>
<span class="sd">        array of correlations with shape (n_targets,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">zs</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="n">zs</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.pearsonr_scorer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">pearsonr_scorer</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Scorer function for RidgeCV that computes the Pearson correlation between the
predicted and true values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.pearsonr_scorer(estimator)" class="doc doc-heading doc-heading-parameter">                  <code>estimator</code>
</h3>            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A trained scikit-learn estimator with a <code>predict</code> method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.pearsonr_scorer(X)" class="doc doc-heading doc-heading-parameter">                  <code>X</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input data used for prediction.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.pearsonr_scorer(y)" class="doc doc-heading doc-heading-parameter">                  <code>y</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The true target values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="returns:" open>
  <summary>Returns:</summary>
  <p>float
    The Pearson correlation coefficient between the predicted and true values.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pearsonr_scorer</span><span class="p">(</span>
    <span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scorer function for RidgeCV that computes the Pearson correlation between the</span>
<span class="sd">    predicted and true values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    estimator : object</span>
<span class="sd">        A trained scikit-learn estimator with a `predict` method.</span>
<span class="sd">    X : np.ndarray</span>
<span class="sd">        The input data used for prediction.</span>
<span class="sd">    y : np.ndarray</span>
<span class="sd">        The true target values.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    float</span>
<span class="sd">        The Pearson correlation coefficient between the predicted and true values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y_predict</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.ridge_corr" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">ridge_corr</span><span class="p">(</span><span class="n">Rstim</span><span class="p">,</span> <span class="n">Pstim</span><span class="p">,</span> <span class="n">Rresp</span><span class="p">,</span> <span class="n">Presp</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">normalpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">single</span><span class="p">,</span> <span class="n">corrmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">singcutoff</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">use_corr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;ridge_corr&#39;</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Uses ridge regression to find a linear transformation of [Rstim] that
approximates [Rresp]. Then tests by comparing the transformation of [Pstim] to
[Presp]. This procedure is repeated for each regularization parameter alpha in
[alphas]. The correlation between each prediction and each response for each alpha
is returned. Note that the regression weights are NOT returned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(Rstim)" class="doc doc-heading doc-heading-parameter">                  <code>Rstim</code>
</h3>            </td>
            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TR">TR</span>, <span title="N">N</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training stimuli with TR time points and N features. Each feature should be
Z-scored across time.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(Pstim)" class="doc doc-heading doc-heading-parameter">                  <code>Pstim</code>
</h3>            </td>
            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TP">TP</span>, <span title="N">N</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Test stimuli with TP time points and N features. Each feature should be Z-scored
across time.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(Rresp)" class="doc doc-heading doc-heading-parameter">                  <code>Rresp</code>
</h3>            </td>
            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TR">TR</span>, <span title="M">M</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training responses with TR time points and M responses (voxels, neurons,
what-have-you). Each response should be Z-scored across time.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(Presp)" class="doc doc-heading doc-heading-parameter">                  <code>Presp</code>
</h3>            </td>
            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="TP">TP</span>, <span title="M">M</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Test responses with TP time points and M responses.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(alphas)" class="doc doc-heading doc-heading-parameter">                  <code>alphas</code>
</h3>            </td>
            <td>
                  <code>(<span title="list">list</span> or <span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="A">A</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ridge parameters to be tested. Should probably be log-spaced.
np.logspace(0, 3, 20) works well.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(normalpha)" class="doc doc-heading doc-heading-parameter">                  <code>normalpha</code>
</h3>            </td>
            <td>
                  <code><span title="boolean">boolean</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether ridge parameters should be normalized by the Frobenius norm of Rstim.
Good for comparing models with different numbers of parameters.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(dtype)" class="doc doc-heading doc-heading-parameter">                  <code>dtype</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.dtype">dtype</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All data will be cast as this dtype for computation. np.single is used by
default for memory efficiency.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.single">single</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(corrmin)" class="doc doc-heading doc-heading-parameter">                  <code>corrmin</code>
</h3>            </td>
            <td>
                  <code>float in [0..1]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Purely for display purposes. After each alpha is tested, the number of responses
with correlation greater than corrmin minus the number of responses with
correlation less than negative corrmin will be printed. For long-running
regressions this vague metric of non-centered skewness can give you a rough
sense of how well the model is working before it's done.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(singcutoff)" class="doc doc-heading doc-heading-parameter">                  <code>singcutoff</code>
</h3>            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first step in ridge regression is computing the singular value decomposition
(SVD) of the stimulus Rstim. If Rstim is not full rank, some singular values
will be approximately equal to zero and the corresponding singular vectors will
be noise. These singular values/vectors should be removed both for speed (the
fewer multiplications the better!) and accuracy. Any singular values less than
singcutoff will be removed.</p>
              </div>
            </td>
            <td>
                  <code>1e-10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_corr(use_corr)" class="doc doc-heading doc-heading-parameter">                  <code>use_corr</code>
</h3>            </td>
            <td>
                  <code><span title="boolean">boolean</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, this function will use correlation as its metric of model fit. If
False, this function will instead use variance explained (R-squared) as its
metric of model fit. For ridge regression this can make a big difference --
highly regularized solutions will have very small norms and will thus explain
very little variance while still leading to high correlations, as correlation
is scale-free while R**2 is not.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Rcorrs</code></td>            <td>
                  <code>(<span title="array_like">array_like</span>, <span title="shape">shape</span>(<span title="A">A</span>, <span title="M">M</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The correlation between each predicted response and each column of Presp for
each alpha.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ridge_corr</span><span class="p">(</span>
    <span class="n">Rstim</span><span class="p">,</span>
    <span class="n">Pstim</span><span class="p">,</span>
    <span class="n">Rresp</span><span class="p">,</span>
    <span class="n">Presp</span><span class="p">,</span>
    <span class="n">alphas</span><span class="p">,</span>
    <span class="n">normalpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">single</span><span class="p">,</span>
    <span class="n">corrmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">singcutoff</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span>
    <span class="n">use_corr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;ridge_corr&quot;</span><span class="p">),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses ridge regression to find a linear transformation of [Rstim] that</span>
<span class="sd">    approximates [Rresp]. Then tests by comparing the transformation of [Pstim] to</span>
<span class="sd">    [Presp]. This procedure is repeated for each regularization parameter alpha in</span>
<span class="sd">    [alphas]. The correlation between each prediction and each response for each alpha</span>
<span class="sd">    is returned. Note that the regression weights are NOT returned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Rstim : array_like, shape (TR, N)</span>
<span class="sd">        Training stimuli with TR time points and N features. Each feature should be</span>
<span class="sd">        Z-scored across time.</span>
<span class="sd">    Pstim : array_like, shape (TP, N)</span>
<span class="sd">        Test stimuli with TP time points and N features. Each feature should be Z-scored</span>
<span class="sd">        across time.</span>
<span class="sd">    Rresp : array_like, shape (TR, M)</span>
<span class="sd">        Training responses with TR time points and M responses (voxels, neurons,</span>
<span class="sd">        what-have-you). Each response should be Z-scored across time.</span>
<span class="sd">    Presp : array_like, shape (TP, M)</span>
<span class="sd">        Test responses with TP time points and M responses.</span>
<span class="sd">    alphas : list or array_like, shape (A,)</span>
<span class="sd">        Ridge parameters to be tested. Should probably be log-spaced.</span>
<span class="sd">        np.logspace(0, 3, 20) works well.</span>
<span class="sd">    normalpha : boolean</span>
<span class="sd">        Whether ridge parameters should be normalized by the Frobenius norm of Rstim.</span>
<span class="sd">        Good for comparing models with different numbers of parameters.</span>
<span class="sd">    dtype : np.dtype</span>
<span class="sd">        All data will be cast as this dtype for computation. np.single is used by</span>
<span class="sd">        default for memory efficiency.</span>
<span class="sd">    corrmin : float in [0..1]</span>
<span class="sd">        Purely for display purposes. After each alpha is tested, the number of responses</span>
<span class="sd">        with correlation greater than corrmin minus the number of responses with</span>
<span class="sd">        correlation less than negative corrmin will be printed. For long-running</span>
<span class="sd">        regressions this vague metric of non-centered skewness can give you a rough</span>
<span class="sd">        sense of how well the model is working before it&#39;s done.</span>
<span class="sd">    singcutoff : float</span>
<span class="sd">        The first step in ridge regression is computing the singular value decomposition</span>
<span class="sd">        (SVD) of the stimulus Rstim. If Rstim is not full rank, some singular values</span>
<span class="sd">        will be approximately equal to zero and the corresponding singular vectors will</span>
<span class="sd">        be noise. These singular values/vectors should be removed both for speed (the</span>
<span class="sd">        fewer multiplications the better!) and accuracy. Any singular values less than</span>
<span class="sd">        singcutoff will be removed.</span>
<span class="sd">    use_corr : boolean</span>
<span class="sd">        If True, this function will use correlation as its metric of model fit. If</span>
<span class="sd">        False, this function will instead use variance explained (R-squared) as its</span>
<span class="sd">        metric of model fit. For ridge regression this can make a big difference --</span>
<span class="sd">        highly regularized solutions will have very small norms and will thus explain</span>
<span class="sd">        very little variance while still leading to high correlations, as correlation</span>
<span class="sd">        is scale-free while R**2 is not.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Rcorrs : array_like, shape (A, M)</span>
<span class="sd">        The correlation between each predicted response and each column of Presp for</span>
<span class="sd">        each alpha.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">## Calculate SVD of stimulus matrix</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Doing SVD...&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Vh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">Rstim</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;NORMAL SVD FAILED, trying more robust dgesvd..&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">text.regression.svd_dgesvd</span> <span class="kn">import</span> <span class="n">svd_dgesvd</span>  <span class="c1"># type: ignore</span>

        <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Vh</span> <span class="o">=</span> <span class="n">svd_dgesvd</span><span class="p">(</span><span class="n">Rstim</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">## Truncate tiny singular values for speed</span>
    <span class="n">origsize</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ngoodS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">S</span> <span class="o">&gt;</span> <span class="n">singcutoff</span><span class="p">)</span>
    <span class="n">nbad</span> <span class="o">=</span> <span class="n">origsize</span> <span class="o">-</span> <span class="n">ngoodS</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span> <span class="p">:</span><span class="n">ngoodS</span><span class="p">]</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[:</span><span class="n">ngoodS</span><span class="p">]</span>
    <span class="n">Vh</span> <span class="o">=</span> <span class="n">Vh</span><span class="p">[:</span><span class="n">ngoodS</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Dropped </span><span class="si">%d</span><span class="s2"> tiny singular values.. (U is now </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nbad</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1">## Normalize alpha by the Frobenius norm</span>
    <span class="c1"># frob = np.sqrt((S**2).sum()) ## Frobenius!</span>
    <span class="n">frob</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># frob = S.sum()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Training stimulus has Frobenius norm: </span><span class="si">%0.03f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">frob</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalpha</span><span class="p">:</span>
        <span class="n">nalphas</span> <span class="o">=</span> <span class="n">alphas</span> <span class="o">*</span> <span class="n">frob</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nalphas</span> <span class="o">=</span> <span class="n">alphas</span>

    <span class="c1">## Precompute some products for speed</span>
    <span class="n">UR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">Rresp</span><span class="p">)</span>  <span class="c1">## Precompute this matrix product for speed</span>
    <span class="n">PVh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Pstim</span><span class="p">,</span> <span class="n">Vh</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>  <span class="c1">## Precompute this matrix product for speed</span>

    <span class="c1"># Prespnorms = np.apply_along_axis(np.linalg.norm, 0, Presp) ## Precompute test</span>
    <span class="c1"># response norms</span>
    <span class="n">zPresp</span> <span class="o">=</span> <span class="n">zs</span><span class="p">(</span><span class="n">Presp</span><span class="p">)</span>
    <span class="n">Prespvar</span> <span class="o">=</span> <span class="n">Presp</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Rcorrs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">## Holds training correlations for each alpha</span>
    <span class="k">for</span> <span class="n">na</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nalphas</span><span class="p">,</span> <span class="n">alphas</span><span class="p">):</span>
        <span class="c1"># D = np.diag(S/(S**2+a**2)) ## Reweight singular vectors by the ridge parameter</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">S</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">S</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">na</span><span class="o">**</span><span class="mi">2</span>
        <span class="p">)</span>  <span class="c1">## Reweight singular vectors by the (normalized?) ridge parameter</span>

        <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="n">mult_diag</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">PVh</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">UR</span>
        <span class="p">)</span>  <span class="c1">## Best (1.75 seconds to prediction in test)</span>
        <span class="c1"># pred = np.dot(mult_diag(D, np.dot(Pstim, Vh.T), left=False), UR) ## Better</span>
        <span class="c1"># (2.0 seconds to prediction in test)</span>

        <span class="c1"># pvhd = reduce(np.dot, [Pstim, Vh.T, D]) ## Pretty good (2.4 seconds to</span>
        <span class="c1"># prediction in test)</span>
        <span class="c1"># pred = np.dot(pvhd, UR)</span>

        <span class="c1"># wt = reduce(np.dot, [Vh.T, D, UR]).astype(dtype) ## Bad (14.2 seconds to</span>
        <span class="c1"># prediction in test)</span>
        <span class="c1"># wt = reduce(np.dot, [Vh.T, D, U.T, Rresp]).astype(dtype) ## Worst</span>
        <span class="c1"># pred = np.dot(Pstim, wt) ## Predict test responses</span>

        <span class="k">if</span> <span class="n">use_corr</span><span class="p">:</span>
            <span class="c1"># prednorms = np.apply_along_axis(np.linalg.norm, 0, pred) ## Compute</span>
            <span class="c1"># predicted test response norms</span>
            <span class="c1"># Rcorr = np.array(</span>
            <span class="c1">#    [np.corrcoef(Presp[:,ii], pred[:,ii].ravel())[0,1]</span>
            <span class="c1">#     for ii in range(Presp.shape[1])]) ## Slowly compute correlations</span>
            <span class="c1"># Rcorr = np.array(np.sum(np.multiply(Presp, pred), 0)).squeeze()/</span>
            <span class="c1">#            (prednorms*Prespnorms) ## Efficiently compute correlations</span>
            <span class="n">Rcorr</span> <span class="o">=</span> <span class="p">(</span><span class="n">zPresp</span> <span class="o">*</span> <span class="n">zs</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## Compute variance explained</span>
            <span class="n">resvar</span> <span class="o">=</span> <span class="p">(</span><span class="n">Presp</span> <span class="o">-</span> <span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Rcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">resvar</span> <span class="o">/</span> <span class="n">Prespvar</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">Rcorr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Rcorr</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Rcorrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rcorr</span><span class="p">)</span>

        <span class="n">log_template</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Training: alpha=</span><span class="si">%0.3f</span><span class="s2">, mean corr=</span><span class="si">%0.5f</span><span class="s2">,&quot;</span>
            <span class="s2">&quot; max corr=</span><span class="si">%0.5f</span><span class="s2">, over-under(</span><span class="si">%0.2f</span><span class="s2">)=</span><span class="si">%d</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">log_msg</span> <span class="o">=</span> <span class="n">log_template</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">a</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Rcorr</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Rcorr</span><span class="p">),</span>
            <span class="n">corrmin</span><span class="p">,</span>
            <span class="p">(</span><span class="n">Rcorr</span> <span class="o">&gt;</span> <span class="n">corrmin</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="n">Rcorr</span> <span class="o">&gt;</span> <span class="n">corrmin</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">log_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">log_msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Rcorrs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.ridge_regression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">ridge_regression</span><span class="p">(</span><span class="n">train_stories</span><span class="p">,</span> <span class="n">test_stories</span><span class="p">,</span> <span class="n">X_data_dict</span><span class="p">,</span> <span class="n">y_data_dict</span><span class="p">,</span> <span class="n">score_fct</span><span class="p">,</span> <span class="n">alphas</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Runs CVRidgeRegression on given train stories, returns scores for
test story, regression weights, and the best alphas.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression(train_stories)" class="doc doc-heading doc-heading-parameter">                  <code>train_stories</code>
</h3>            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of training stories. Stories must be in X_data_dict.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression(test_stories)" class="doc doc-heading doc-heading-parameter">                  <code>test_stories</code>
</h3>            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of testing stories. Stories must be in X_data_dict.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression(X_data_dict)" class="doc doc-heading doc-heading-parameter">                  <code>X_data_dict</code>
</h3>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with story to X_data (features) pairs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression(y_data_dict)" class="doc doc-heading doc-heading-parameter">                  <code>y_data_dict</code>
</h3>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with story to y_data (fMRI data) pairs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression(score_fct)" class="doc doc-heading doc-heading-parameter">                  <code>score_fct</code>
</h3>            </td>
            <td>
                  <code>fct(np.ndarray, np.ndarray) -&gt; np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function taking y_test (shape = (number_trs, n_voxels))
and y_predict (same shape as y_test) and returning an
array with an entry for each voxel (shape = (n_voxels)).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression(alphas)" class="doc doc-heading doc-heading-parameter">                  <code>alphas</code>
</h3>            </td>
            <td>
                  <code>np.ndarray or `None`</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of alpha values to optimize over. If <code>None</code>, will choose
default value.</p>
              </div>
            </td>
            <td>
                  <code>= `np.logspace(1, 3, 10)`</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>scores</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prediction scores for the test stories.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>weights</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The regression weights.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_alphas</code></td>            <td>
                  <code><span title="float">float</span> | <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The best alphas for each voxel.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ridge_regression</span><span class="p">(</span>
    <span class="n">train_stories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">test_stories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">X_data_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">y_data_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">score_fct</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">alphas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs CVRidgeRegression on given train stories, returns scores for</span>
<span class="sd">    test story, regression weights, and the best alphas.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    train_stories: list of str</span>
<span class="sd">        List of training stories. Stories must be in X_data_dict.</span>
<span class="sd">    test_stories: list of str</span>
<span class="sd">        List of testing stories. Stories must be in X_data_dict.</span>
<span class="sd">    X_data_dict : dict[str, np.ndarray]</span>
<span class="sd">        Dict with story to X_data (features) pairs.</span>
<span class="sd">    y_data_dict : dict[str, np.ndarray]</span>
<span class="sd">        Dict with story to y_data (fMRI data) pairs.</span>
<span class="sd">    score_fct : fct(np.ndarray, np.ndarray) -&gt; np.ndarray</span>
<span class="sd">        A function taking y_test (shape = (number_trs, n_voxels))</span>
<span class="sd">        and y_predict (same shape as y_test) and returning an</span>
<span class="sd">        array with an entry for each voxel (shape = (n_voxels)).</span>
<span class="sd">    alphas : np.ndarray or `None`, default = `np.logspace(1, 3, 10)`</span>
<span class="sd">        Array of alpha values to optimize over. If `None`, will choose</span>
<span class="sd">        default value.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scores : np.ndarray</span>
<span class="sd">        The prediction scores for the test stories.</span>
<span class="sd">    weights : np.ndarray</span>
<span class="sd">        The regression weights.</span>
<span class="sd">    best_alphas : float | np.ndarray</span>
<span class="sd">        The best alphas for each voxel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">alphas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">X_train_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_data_dict</span><span class="p">[</span><span class="n">story</span><span class="p">]</span> <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">train_stories</span><span class="p">]</span>
    <span class="n">y_train_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_data_dict</span><span class="p">[</span><span class="n">story</span><span class="p">]</span> <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">train_stories</span><span class="p">]</span>
    <span class="n">X_test_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_data_dict</span><span class="p">[</span><span class="n">story</span><span class="p">]</span> <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">test_stories</span><span class="p">]</span>
    <span class="n">y_test_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_data_dict</span><span class="p">[</span><span class="n">story</span><span class="p">]</span> <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">test_stories</span><span class="p">]</span>

    <span class="n">X_train_unnormalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">X_train_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">y_train_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">X_test_unnormalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">X_test_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">y_test_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">X_means</span> <span class="o">=</span> <span class="n">X_train_unnormalized</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">X_stds</span> <span class="o">=</span> <span class="n">X_train_unnormalized</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">X_train</span> <span class="o">=</span> <span class="n">z_score</span><span class="p">(</span><span class="n">X_train_unnormalized</span><span class="p">,</span> <span class="n">X_means</span><span class="p">,</span> <span class="n">X_stds</span><span class="p">)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">z_score</span><span class="p">(</span><span class="n">X_test_unnormalized</span><span class="p">,</span> <span class="n">X_means</span><span class="p">,</span> <span class="n">X_stds</span><span class="p">)</span>

    <span class="n">clf</span> <span class="o">=</span> <span class="n">RidgeCV</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span> <span class="n">alpha_per_target</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">pearsonr_scorer</span><span class="p">)</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="n">y_predict</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">score_fct</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scores</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">alpha_</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.ridge_regression_huth" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">ridge_regression_huth</span><span class="p">(</span><span class="n">train_stories</span><span class="p">,</span> <span class="n">test_stories</span><span class="p">,</span> <span class="n">X_data_dict</span><span class="p">,</span> <span class="n">y_data_dict</span><span class="p">,</span> <span class="n">score_fct</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">nboots</span><span class="p">,</span> <span class="n">chunklen</span><span class="p">,</span> <span class="n">nchunks</span><span class="p">,</span> <span class="n">singcutoff</span><span class="p">,</span> <span class="n">single_alpha</span><span class="p">,</span> <span class="n">use_corr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Runs CVRidgeRegression on given train stories, returns scores for
test story, regression weights, and the best alphas. Instead of using RidgeCV from
sklearn, uses the Huth lab's implementation
(https://github.com/HuthLab/deep-fMRI-dataset/blob/master/encoding/ridge_utils/ridge.py).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression_huth(train_stories)" class="doc doc-heading doc-heading-parameter">                  <code>train_stories</code>
</h3>            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of training stories. Stories must be in X_data_dict.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression_huth(test_stories)" class="doc doc-heading doc-heading-parameter">                  <code>test_stories</code>
</h3>            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of testing stories. Stories must be in X_data_dict.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression_huth(X_data_dict)" class="doc doc-heading doc-heading-parameter">                  <code>X_data_dict</code>
</h3>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with story to X_data (features) pairs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression_huth(y_data_dict)" class="doc doc-heading doc-heading-parameter">                  <code>y_data_dict</code>
</h3>            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with story to y_data (fMRI data) pairs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression_huth(score_fct)" class="doc doc-heading doc-heading-parameter">                  <code>score_fct</code>
</h3>            </td>
            <td>
                  <code>fct(np.ndarray, np.ndarray) -&gt; np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function taking y_test (shape = (number_trs, n_voxels))
and y_predict (same shape as y_test) and returning an
array with an entry for each voxel (shape = (n_voxels)).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.ridge_regression_huth(alphas)" class="doc doc-heading doc-heading-parameter">                  <code>alphas</code>
</h3>            </td>
            <td>
                  <code>np.ndarray or `None`,</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of alpha values to optimize over. If <code>None</code>, will choose
default value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>scores</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prediction scores for the test stories.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>weights</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The regression weights.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_alphas</code></td>            <td>
                  <code><span title="float">float</span> | <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The best alphas for each voxel.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ridge_regression_huth</span><span class="p">(</span>
    <span class="n">train_stories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">test_stories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">X_data_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">y_data_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">score_fct</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">alphas</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">nboots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">chunklen</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">nchunks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">singcutoff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">single_alpha</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">use_corr</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs CVRidgeRegression on given train stories, returns scores for</span>
<span class="sd">    test story, regression weights, and the best alphas. Instead of using RidgeCV from</span>
<span class="sd">    sklearn, uses the Huth lab&#39;s implementation</span>
<span class="sd">    (https://github.com/HuthLab/deep-fMRI-dataset/blob/master/encoding/ridge_utils/ridge.py).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    train_stories: list of str</span>
<span class="sd">        List of training stories. Stories must be in X_data_dict.</span>
<span class="sd">    test_stories: list of str</span>
<span class="sd">        List of testing stories. Stories must be in X_data_dict.</span>
<span class="sd">    X_data_dict : dict[str, np.ndarray]</span>
<span class="sd">        Dict with story to X_data (features) pairs.</span>
<span class="sd">    y_data_dict : dict[str, np.ndarray]</span>
<span class="sd">        Dict with story to y_data (fMRI data) pairs.</span>
<span class="sd">    score_fct : fct(np.ndarray, np.ndarray) -&gt; np.ndarray</span>
<span class="sd">        A function taking y_test (shape = (number_trs, n_voxels))</span>
<span class="sd">        and y_predict (same shape as y_test) and returning an</span>
<span class="sd">        array with an entry for each voxel (shape = (n_voxels)).</span>
<span class="sd">    alphas : np.ndarray or `None`,</span>
<span class="sd">        Array of alpha values to optimize over. If `None`, will choose</span>
<span class="sd">        default value.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scores : np.ndarray</span>
<span class="sd">        The prediction scores for the test stories.</span>
<span class="sd">    weights : np.ndarray</span>
<span class="sd">        The regression weights.</span>
<span class="sd">    best_alphas : float | np.ndarray</span>
<span class="sd">        The best alphas for each voxel.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">X_train_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_data_dict</span><span class="p">[</span><span class="n">story</span><span class="p">]</span> <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">train_stories</span><span class="p">]</span>
    <span class="n">y_train_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_data_dict</span><span class="p">[</span><span class="n">story</span><span class="p">]</span> <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">train_stories</span><span class="p">]</span>
    <span class="n">X_test_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_data_dict</span><span class="p">[</span><span class="n">story</span><span class="p">]</span> <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">test_stories</span><span class="p">]</span>
    <span class="n">y_test_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_data_dict</span><span class="p">[</span><span class="n">story</span><span class="p">]</span> <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">test_stories</span><span class="p">]</span>

    <span class="n">X_train_unnormalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">X_train_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">y_train_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">X_test_unnormalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">X_test_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">y_test_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">X_means</span> <span class="o">=</span> <span class="n">X_train_unnormalized</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">X_stds</span> <span class="o">=</span> <span class="n">X_train_unnormalized</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">X_train</span> <span class="o">=</span> <span class="n">z_score</span><span class="p">(</span><span class="n">X_train_unnormalized</span><span class="p">,</span> <span class="n">X_means</span><span class="p">,</span> <span class="n">X_stds</span><span class="p">)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">z_score</span><span class="p">(</span><span class="n">X_test_unnormalized</span><span class="p">,</span> <span class="n">X_means</span><span class="p">,</span> <span class="n">X_stds</span><span class="p">)</span>

    <span class="n">wt</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">bestalphas</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bootstrap_ridge</span><span class="p">(</span>
        <span class="n">X_train</span><span class="p">,</span>
        <span class="n">y_train</span><span class="p">,</span>
        <span class="n">X_test</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">,</span>
        <span class="n">alphas</span><span class="p">,</span>
        <span class="n">nboots</span><span class="o">=</span><span class="n">nboots</span><span class="p">,</span>
        <span class="n">chunklen</span><span class="o">=</span><span class="n">chunklen</span><span class="p">,</span>
        <span class="n">nchunks</span><span class="o">=</span><span class="n">nchunks</span><span class="p">,</span>
        <span class="n">singcutoff</span><span class="o">=</span><span class="n">singcutoff</span><span class="p">,</span>
        <span class="n">single_alpha</span><span class="o">=</span><span class="n">single_alpha</span><span class="p">,</span>
        <span class="n">use_corr</span><span class="o">=</span><span class="n">use_corr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">score_fct</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">wt</span><span class="p">),</span> <span class="n">y_test</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scores</span><span class="p">,</span> <span class="n">wt</span><span class="p">,</span> <span class="n">bestalphas</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.z_score" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">z_score</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return <code>data</code> z-scored by given <code>means</code> and standard deviations <code>stds</code>. Useful
to z-score after train/test splits with the same mean in cross-validation settings
to prevent data leakage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.z_score(data)" class="doc doc-heading doc-heading-parameter">                  <code>data</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape = (n_samples, n_features) or (n_samples,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.z_score(means)" class="doc doc-heading doc-heading-parameter">                  <code>means</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape = (n_features,) or (1, n_features)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.z_score(stds)" class="doc doc-heading doc-heading-parameter">                  <code>stds</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape = (n_features,) or (1, n_features)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized data, shape = (n_samples, n_features) or (1, n_features)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">z_score</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">means</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">stds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return `data` z-scored by given `means` and standard deviations `stds`. Useful</span>
<span class="sd">    to z-score after train/test splits with the same mean in cross-validation settings</span>
<span class="sd">    to prevent data leakage.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : np.ndarray</span>
<span class="sd">        shape = (n_samples, n_features) or (n_samples,)</span>
<span class="sd">    means : np.ndarray</span>
<span class="sd">        shape = (n_features,) or (1, n_features)</span>
<span class="sd">    stds : np.ndarray</span>
<span class="sd">        shape = (n_features,) or (1, n_features)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">       Normalized data, shape = (n_samples, n_features) or (1, n_features)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">means</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">stds</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="encoders.regression.zs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">zs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the z-score of the input array. Z-scores along the first dimension for
n-dimensional arrays by default.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="encoders.regression.zs(x)" class="doc doc-heading doc-heading-parameter">                  <code>x</code>
</h3>            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input array. Can be 1D or n-dimensional.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>z</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Z-score of x.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/encoders/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">zs</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the z-score of the input array. Z-scores along the first dimension for</span>
<span class="sd">    n-dimensional arrays by default.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.ndarray</span>
<span class="sd">        Input array. Can be 1D or n-dimensional.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    z : np.ndarray</span>
<span class="sd">        Z-score of x.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.tabs", "navigation.path", "navigation.sections", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>